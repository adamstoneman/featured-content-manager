/*! featured-content-manager  filename.min.js 2017-04-26 2:06:35 PM */
var $=jQuery.noConflict(),timer;$(function(){function a(){$(".sortable").sortable({connectWith:".connectable",opacity:.5,handle:".fcm-title",placeholder:"placeholder",receive:function(a,b){var c=$(b.item).parents("ul").data("area"),d=$(b.item).parents("ul.sortable li").find("input[name^=post_id]").val();$(b.item).find("input[name^=area]").first().val(c),void 0===d?$(b.item).children(".fcm-inside").find("input[name^=child]").val("false"):$(b.item).find("input[name^=child]").val("true")},sort:function(a,b){},stop:function(a,c){b(),changeState=!0}})}function b(){$("ul.featured-area").each(function(a){var b=$(this).parents("li.customize-control"),c=$(b).children("input.customizer-setting"),d=1;$(this).children("li").each(function(a){$(this).first("fieldset").find("input, textarea, select").each(function(a){var b=$(this).attr("name");$(this).attr("name",b.replace(/\[(.+?)\]/g,"["+d+"]"))}),$(this).first("fieldset").find("input[name^=menu_order]").val(a),d+=1,$(this).find("li").each(function(a){$(this).first("fieldset").find("input, textarea, select").each(function(a){var b=$(this).attr("name");$(this).attr("name",b.replace(/\[(.+?)\]/g,"["+d+"]"))}),$(this).first("fieldset").find("input[name^=menu_order]").val(a),d+=1})});var e=$(b).find("ul.featured-area:first :input").serialize();$(c).val()!=e&&$.ajax({type:"POST",dataType:"json",url:ajaxurl,data:e,success:function(a){a.error===!1&&($(c).val(e),$(c).trigger("change"))}})})}function c(){clearTimeout(timer);var a=500;this.value;timer=setTimeout(function(){b()},a)}function d(){clearTimeout(timer);var a=500;this.value;timer=setTimeout(function(){e()},a)}function e(){var a,b,c=$("#featured-items-search").val();if(!(c.length<=2)){$("#featured-items-search").addClass("loading");var d={action:"search_content",search_term:c};$.post(ajaxurl,d,function(c){$("#featured-items-search").removeClass("loading"),c.error?$("#featured-items-filter-result ul").html('<li class="error">'+c.message+"</li>"):($("#featured-items-filter-result ul").html(""),a=wp.template("featured-area-search-result-item"),$(c.result).each(function(c){b=a(this),$("#featured-items-filter-result ul").append(b)}))},"JSON")}}function f(a){var b=$(a.currentTarget).val();$(a.currentTarget).closest("li").find(".fcm-title h4").eq(0).text(b)}$("body").ready(function(){a()}),$(document).on("click",".sidebar-name-arrow, .fcm-title h4",function(){$(this).closest("li").toggleClass("closed")}),$(document).on("click",".sidebar-parent-arrow",function(){$(this).parents("li").toggleClass("parent")}),$(document).on("click",".remove",function(){$(this).closest("li").remove(),c()}),$(document).on("click",".sidebar-delete-icon",function(){$(this).closest("li").remove(),c()}),$("body").on("click",".edit-thumbnail",function(a){var b=wp.media.editor.send.attachment,c=$(this).closest("li");return wp.media.editor.send.attachment=function(a,d){$(c).find(".edit-thumbnail").first().html('<img src="'+d.url+'">'),$(c).find("input[name^=post_thumbnail]").first().val(d.id),$(c).find("input[name^=post_thumbnail]").first().trigger("change"),$(c).find(".remove-thumbnail").show(),wp.media.editor.send.attachment=b},wp.media.editor.open(),!1}),$("body").on("click",".remove-thumbnail",function(a){var b=$(this).closest("li");$(b).find(".edit-thumbnail").first().html("Ange utvald bild"),$(b).find("input[name^=post_thumbnail]").first().val(""),$(b).find("input[name^=post_thumbnail]").first().trigger("change"),$(b).find(".remove-thumbnail").first().hide()}),$("body.wp-customizer").on("click",function(a){var b=$(a.target);b.closest("div#available-featured-items").length||$(b).hasClass("sidebar-delete-icon")||($("body.wp-customizer").hasClass("adding-featured-items")?($("body").removeClass("adding-featured-items"),$(".adding-featured-items-target").removeClass("adding-featured-items-target")):$(b).hasClass("add-featured-items")&&($(a.target).parent().parent().children("ul.featured-area").addClass("adding-featured-items-target"),$("body").addClass("adding-featured-items"),$("#featured-items-search").focus()))}),$("body").on("click","li.featured-area-search-result-item",function(b){var d=$(this).data("id"),e="";$(this).data("site_id")&&(e=$(this).data("site_id"));var f=$(".adding-featured-items-target");$(this).addClass("added");var g={action:"get_post",post_id:d,site_id:e,target:""};$.post(ajaxurl,g,function(b){var d,e=$(".adding-featured-items-target li").length+1;d=wp.template("featured-item"),b.post.ID="new",b.index=e;var g=d(b);$(f).append(g),c(),a()},"JSON")}),$("body").on("click","a.featured-item-add-url-item",function(b){b.preventDefault();var d,e=$(".adding-featured-items-target li").length+1;d=wp.template("featured-item-url");var f=$(".adding-featured-items-target"),g=1,h={post:{ID:"new",post_title:""},post_original:{ID:0},post_thumbnail:"",index:e,site_id:g,url:""},i=d(h);$(f).append(i),c(),a()}),$(document).on("keyup","#featured-items-search",d),$(document).on("keyup",".sortable li input[type=text], .sortable li textarea, .sortable li input[type=url]",c),$(document).on("keyup",".sortable li input[name^=post_title]",f),$(document).on("change",".sortable li input[type=hidden], .sortable li select",c)});